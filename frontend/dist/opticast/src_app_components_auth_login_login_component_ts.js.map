{"version":3,"file":"src_app_components_auth_login_login_component_ts.js","mappings":";;;;;;;;;;;;;;;;;;;AAC+C;AAC0C;;;;;;;;;IA2B3EG,4DAAA,cAAiE;IAC/DA,oDAAA,gCACF;IAAAA,0DAAA,EAAM;;;;;IAaNA,4DAAA,cAAiE;IAC/DA,oDAAA,wCACF;IAAAA,0DAAA,EAAM;;;;;IASJA,uDAAA,eAA2E;;;AAsDrF,MAAOK,cAAc;EAIzBC,YACUC,EAAe,EACfC,WAAwB,EACxBC,MAAc,EACdC,YAA0B;IAH1B,KAAAH,EAAE,GAAFA,EAAE;IACF,KAAAC,WAAW,GAAXA,WAAW;IACX,KAAAC,MAAM,GAANA,MAAM;IACN,KAAAC,YAAY,GAAZA,YAAY;IANtB,KAAAC,OAAO,GAAG,KAAK;IAQb,IAAI,CAACC,SAAS,GAAG,IAAI,CAACL,EAAE,CAACM,KAAK,CAAC;MAC7BC,QAAQ,EAAE,CAAC,EAAE,EAAE,CAAChB,sDAAU,CAACiB,QAAQ,CAAC,CAAC;MACrCC,QAAQ,EAAE,CAAC,EAAE,EAAE,CAAClB,sDAAU,CAACiB,QAAQ,CAAC;KACrC,CAAC;EACJ;EAEAE,QAAQA,CAAA;IACN,IAAI,IAAI,CAACL,SAAS,CAACM,KAAK,EAAE;MACxB,IAAI,CAACP,OAAO,GAAG,IAAI;MAEnB,IAAI,CAACH,WAAW,CAACW,KAAK,CAAC,IAAI,CAACP,SAAS,CAACQ,KAAK,CAAC,CAACC,SAAS,CAAC;QACrDC,IAAI,EAAGC,QAAQ,IAAI;UACjB,IAAI,CAACZ,OAAO,GAAG,KAAK;UACpB,IAAI,CAACD,YAAY,CAACc,SAAS,CAAC,eAAe,EAAE,SAAS,CAAC;UAEvD;UACA;UACA,IAAID,QAAQ,CAACE,IAAI,EAAEC,IAAI,EAAEC,GAAG,KAAK,SAAS,IAAIJ,QAAQ,CAACE,IAAI,EAAEC,IAAI,EAAEE,aAAa,KAAK,IAAI,EAAE;YACzF,IAAI,CAACnB,MAAM,CAACoB,QAAQ,CAAC,CAAC,kBAAkB,CAAC,CAAC;WAC3C,MAAM;YACL,IAAI,CAACpB,MAAM,CAACoB,QAAQ,CAAC,CAAC,YAAY,CAAC,CAAC;;QAExC,CAAC;QACDC,KAAK,EAAGA,KAAK,IAAI;UACf,IAAI,CAACnB,OAAO,GAAG,KAAK;UACpB,IAAI,CAACD,YAAY,CAACqB,SAAS,CAACD,KAAK,CAACA,KAAK,EAAEE,OAAO,IAAI,mBAAmB,CAAC;QAC1E;OACD,CAAC;;EAEN;EAEAC,cAAcA,CAACC,SAAiB;IAC9B,MAAMC,KAAK,GAAG,IAAI,CAACvB,SAAS,CAACwB,GAAG,CAACF,SAAS,CAAC;IAC3C,OAAO,CAAC,EAAEC,KAAK,IAAIA,KAAK,CAACE,OAAO,KAAKF,KAAK,CAACG,KAAK,IAAIH,KAAK,CAACI,OAAO,CAAC,CAAC;EACrE;;;uBA5CWlC,cAAc,EAAAL,+DAAA,CAAAyC,uDAAA,GAAAzC,+DAAA,CAAA2C,+DAAA,GAAA3C,+DAAA,CAAA6C,mDAAA,GAAA7C,+DAAA,CAAA+C,iEAAA;IAAA;EAAA;;;YAAd1C,cAAc;MAAA4C,SAAA;MAAAC,UAAA;MAAAC,QAAA,GAAAnD,iEAAA;MAAAqD,KAAA;MAAAC,IAAA;MAAAC,MAAA;MAAAC,QAAA,WAAAC,wBAAAC,EAAA,EAAAC,GAAA;QAAA,IAAAD,EAAA;UA9FjB1D,4DAHN,aAA8F,aACrD,aACA,WAClB;UAAAA,oDAAA,yCAA6B;UAChDA,0DADgD,EAAI,EAC9C;UAEJA,4DADF,aAA2B,cAC6B;UAAxBA,wDAAA,sBAAA6D,iDAAA;YAAA,OAAYF,GAAA,CAAA1C,QAAA,EAAU;UAAA,EAAC;UAEjDjB,4DADF,aAAkB,eACyB;UAAAA,oDAAA,cAAO;UAAAA,0DAAA,EAAQ;UACxDA,uDAAA,gBAOC;UACDA,wDAAA,KAAA+D,8BAAA,iBAAiE;UAGnE/D,0DAAA,EAAM;UAGJA,4DADF,cAAkB,iBACyB;UAAAA,oDAAA,uBAAU;UAAAA,0DAAA,EAAQ;UAC3DA,uDAAA,iBAOC;UACDA,wDAAA,KAAAgE,8BAAA,iBAAiE;UAGnEhE,0DAAA,EAAM;UAGJA,4DADF,eAAoB,kBAKjB;UACCA,wDAAA,KAAAiE,+BAAA,mBAAoE;UACpEjE,oDAAA,IACF;UAGNA,0DAHM,EAAS,EACL,EACD,EACH;UAEJA,4DADF,eAAgD,aACvC;UAAAA,oDAAA,iDAA+B;UAG5CA,0DAH4C,EAAQ,EAC1C,EACF,EACF;;;UA/CMA,uDAAA,GAAuB;UAAvBA,wDAAA,cAAA2D,GAAA,CAAA/C,SAAA,CAAuB;UAQvBZ,uDAAA,GAA+C;UAA/CA,yDAAA,eAAA2D,GAAA,CAAA1B,cAAA,aAA+C;UAGlBjC,uDAAA,EAAgC;UAAhCA,wDAAA,SAAA2D,GAAA,CAAA1B,cAAA,aAAgC;UAY7DjC,uDAAA,GAA+C;UAA/CA,yDAAA,eAAA2D,GAAA,CAAA1B,cAAA,aAA+C;UAGlBjC,uDAAA,EAAgC;UAAhCA,wDAAA,SAAA2D,GAAA,CAAA1B,cAAA,aAAgC;UAS7DjC,uDAAA,GAAyC;UAAzCA,wDAAA,aAAA2D,GAAA,CAAA/C,SAAA,CAAAyB,OAAA,IAAAsB,GAAA,CAAAhD,OAAA,CAAyC;UAElCX,uDAAA,EAAa;UAAbA,wDAAA,SAAA2D,GAAA,CAAAhD,OAAA,CAAa;UACpBX,uDAAA,EACF;UADEA,gEAAA,MAAA2D,GAAA,CAAAhD,OAAA,2DACF;;;qBA/CFd,yDAAY,EAAAyE,iDAAA,EAAEvE,+DAAmB,EAAA0C,4DAAA,EAAAA,gEAAA,EAAAA,2DAAA,EAAAA,gEAAA,EAAAA,8DAAA,EAAAA,2DAAA;MAAAqC,MAAA;IAAA;EAAA","sources":["./src/app/components/auth/login/login.component.ts"],"sourcesContent":["import { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { AuthService } from '../../../services/auth.service';\nimport { ToastService } from '../../../services/toast.service';\n\n@Component({\n  selector: 'app-login',\n  standalone: true,\n  imports: [CommonModule, ReactiveFormsModule],\n  template: `\n    <div class=\"container-fluid vh-100 d-flex align-items-center justify-content-center bg-light\">\n      <div class=\"card shadow-lg login-card\">\n        <div class=\"card-header text-center\">\n          <p class=\" mb-0\">Sistema de Historias Clínicas</p>\n        </div>\n        <div class=\"card-body p-4\">\n          <form [formGroup]=\"loginForm\" (ngSubmit)=\"onSubmit()\">\n            <div class=\"mb-3\">\n              <label for=\"username\" class=\"form-label\">Usuario</label>\n              <input\n                type=\"text\"\n                class=\"form-control\"\n                id=\"username\"\n                formControlName=\"username\"\n                [class.is-invalid]=\"isFieldInvalid('username')\"\n                placeholder=\"Ingrese su usuario\"\n              >\n              <div class=\"invalid-feedback\" *ngIf=\"isFieldInvalid('username')\">\n                El usuario es requerido\n              </div>\n            </div>\n\n            <div class=\"mb-3\">\n              <label for=\"password\" class=\"form-label\">Contraseña</label>\n              <input\n                type=\"password\"\n                class=\"form-control\"\n                id=\"password\"\n                formControlName=\"password\"\n                [class.is-invalid]=\"isFieldInvalid('password')\"\n                placeholder=\"Ingrese su contraseña\"\n              >\n              <div class=\"invalid-feedback\" *ngIf=\"isFieldInvalid('password')\">\n                La contraseña es requerida\n              </div>\n            </div>\n\n            <div class=\"d-grid\">\n              <button\n                type=\"submit\"\n                class=\"btn btn-primary btn-lg\"\n                [disabled]=\"loginForm.invalid || loading\"\n              >\n                <span *ngIf=\"loading\" class=\"spinner-border spinner-border-sm me-2\"></span>\n                {{ loading ? 'Iniciando sesión...' : 'Iniciar Sesión' }}\n              </button>\n            </div>\n          </form>\n        </div>\n        <div class=\"card-footer text-center text-muted\">\n          <small>Sistema de gestión para ópticas</small>\n        </div>\n      </div>\n    </div>\n  `,\n  styles: [`\n    .login-card {\n      border: none;\n      border-radius: 15px;\n      width: 100%;\n      max-width: 400px;\n      min-width: 400px;\n    }\n    \n    .card-header {\n      background: linear-gradient(135deg, var(--primary-color), #0056b3);\n      color: white;\n      border-radius: 15px 15px 0 0 !important;\n      padding: 2rem 1.5rem;\n    }\n    \n    .btn-primary {\n      background: linear-gradient(135deg, var(--primary-color), #0056b3);\n      border: none;\n      border-radius: 10px;\n      padding: 12px;\n      font-weight: 600;\n    }\n    \n    .btn-primary:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 4px 8px rgba(0,123,255,0.3);\n    }\n    \n    .form-control {\n      border-radius: 8px;\n      padding: 12px;\n      border: 2px solid #e9ecef;\n      transition: all 0.3s ease;\n    }\n    \n    .form-control:focus {\n      border-color: var(--primary-color);\n      box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);\n    }\n  `]\n})\nexport class LoginComponent {\n  loginForm: FormGroup;\n  loading = false;\n\n  constructor(\n    private fb: FormBuilder,\n    private authService: AuthService,\n    private router: Router,\n    private toastService: ToastService\n  ) {\n    this.loginForm = this.fb.group({\n      username: ['', [Validators.required]],\n      password: ['', [Validators.required]]\n    });\n  }\n\n  onSubmit(): void {\n    if (this.loginForm.valid) {\n      this.loading = true;\n      \n      this.authService.login(this.loginForm.value).subscribe({\n        next: (response) => {\n          this.loading = false;\n          this.toastService.showToast('Login exitoso', 'success');\n          \n          // Solo usuarios de óptica (rol = 'usuario') deben cambiar contraseña en primer acceso\n          // El administrador (rol = 'admin') puede acceder directamente al dashboard\n          if (response.data?.user?.rol === 'usuario' && response.data?.user?.primer_acceso === true) {\n            this.router.navigate(['/change-password']);\n          } else {\n            this.router.navigate(['/dashboard']);\n          }\n        },\n        error: (error) => {\n          this.loading = false;\n          this.toastService.showError(error.error?.message || 'Error en el login');\n        }\n      });\n    }\n  }\n\n  isFieldInvalid(fieldName: string): boolean {\n    const field = this.loginForm.get(fieldName);\n    return !!(field && field.invalid && (field.dirty || field.touched));\n  }\n}\n\n"],"names":["CommonModule","Validators","ReactiveFormsModule","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵelement","LoginComponent","constructor","fb","authService","router","toastService","loading","loginForm","group","username","required","password","onSubmit","valid","login","value","subscribe","next","response","showToast","data","user","rol","primer_acceso","navigate","error","showError","message","isFieldInvalid","fieldName","field","get","invalid","dirty","touched","ɵɵdirectiveInject","i1","FormBuilder","i2","AuthService","i3","Router","i4","ToastService","selectors","standalone","features","ɵɵStandaloneFeature","decls","vars","consts","template","LoginComponent_Template","rf","ctx","ɵɵlistener","LoginComponent_Template_form_ngSubmit_6_listener","ɵɵtemplate","LoginComponent_div_11_Template","LoginComponent_div_16_Template","LoginComponent_span_19_Template","ɵɵadvance","ɵɵproperty","ɵɵclassProp","ɵɵtextInterpolate1","i5","NgIf","ɵNgNoValidate","DefaultValueAccessor","NgControlStatus","NgControlStatusGroup","FormGroupDirective","FormControlName","styles"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}